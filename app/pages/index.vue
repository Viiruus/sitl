<template>
  <div class="bg-brand-950">
    <!-- Header rÃ©utilisable -->
    <AppHeader />

    <!-- Hero Section -->
    <div class="relative">
      <div class="mx-auto max-w-7xl">
        <div class="relative z-10 pt-14 lg:w-full lg:max-w-2xl">
          <svg class="absolute inset-y-0 right-8 hidden h-full w-80 translate-x-1/2 transform fill-brand-950 lg:block" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
            <polygon points="0,0 90,0 50,100 0,100" />
          </svg>

          <div class="relative px-6 py-32 sm:py-40 lg:px-8 lg:py-40 lg:pr-0 2xl:py-56">
            <div class="mx-auto max-w-2xl lg:mx-0 lg:max-w-xl">
              <h1 class="text-5xl font-semibold tracking-tight text-pretty text-white sm:text-7xl">Vos aventures verticales commencent ici.</h1>
              <p class="mt-8 text-lg font-medium text-pretty text-gray-400 sm:text-xl/8">Escalade outdoor encadrÃ©e par nos guides locaux passionnÃ©s</p>
              <div class="mt-10 flex items-center gap-x-6">
                <a href="#" class="rounded-md bg-secondaryBrand-500 px-3.5 py-2.5 text-sm font-semibold text-white shadow-xs hover:bg-secondaryBrand-400 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-brand-500">Les prochains dÃ©parts</a>
                
                <NuxtLink to="/moniteur-nicolas-guillemain" class="text-sm/6 font-semibold text-white">
                  Rejoindre la communautÃ© <span aria-hidden="true">â†’</span>
                </NuxtLink>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="bg-brand-950 lg:absolute lg:inset-y-0 lg:right-0 lg:w-1/2">
        <img class="aspect-3/2 object-cover lg:aspect-auto lg:size-full" src="~/assets/images/escalade0.jpg" alt="" />
      </div>
    </div>
  </div>
  
    <!-- Section BÃ©nÃ©fices -->
  <section class="bg-brand-900 py-20 sm:py-28 text-white">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
      <p class="text-xs uppercase tracking-[0.5em] text-secondaryBrand-200/80">
        Notre mission ?
      </p>
      <h2 class="mt-4 text-4xl font-semibold tracking-tight sm:text-5xl">
        Votre <span class="text-secondaryBrand-200">{{ activeBenefitWord }}</span>
      </h2>
      <p class="mt-4 max-w-2xl text-base text-brand-100/80">
        Des sÃ©jours imaginÃ©s pour connecter les grimpeurs Ã  la nature, progresser avec des moniteurs diplÃ´mÃ©s
        et vivre une expÃ©rience sympa.
      </p>

      <div class="mt-12 grid gap-6 lg:grid-cols-2">
        <article
          v-for="benefit in benefits"
          :key="benefit.title"
          class="rounded-3xl border border-white/10 bg-white/5 p-6 shadow-xl shadow-black/30 ring-1 ring-white/10"
        >
          <div class="flex items-center gap-3 text-secondaryBrand-200">
            <div class="flex h-12 w-12 items-center justify-center rounded-full bg-secondaryBrand-500/10 text-2xl">
              {{ benefit.emoji }}
            </div>
            <div>
              <p class="text-xs uppercase tracking-[0.4em] text-secondaryBrand-200/90">
                {{ benefit.kicker }}
              </p>
              <h3 class="text-xl font-semibold text-white">
                {{ benefit.title }}
              </h3>
            </div>
          </div>
          <p class="mt-4 text-sm text-brand-100/80">
            {{ benefit.description }}
          </p>
        </article>
      </div>
    </div>
  </section>

  <!-- Section ActivitÃ©s -->
  <section class="bg-white py-24 sm:py-32">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
      <p class="text-xs uppercase tracking-[0.5em] text-brand-500">
        Lâ€™escalade sous toutes ses formes
      </p>
      <h2 class="mt-4 text-4xl font-semibold tracking-tight text-pretty text-gray-900 sm:text-5xl">
        Lâ€™escalade sous toutes ses formes
      </h2>
      <p class="mt-4 max-w-2xl text-base text-gray-600">
        Chaque pratique a ses sensations. Choisis lâ€™activitÃ© qui colle Ã  ton envie du moment et laisse nos guides tâ€™emmener jouer sur le rocher.
      </p>

      <div class="mt-12 grid gap-6 lg:grid-cols-2">
        <article
          v-for="activity in activities"
          :key="activity.title"
          class="rounded-3xl border border-gray-200 bg-white p-6 shadow-lg shadow-gray-200/40"
        >
          <div class="flex items-center gap-3">
            <div class="flex h-12 w-12 items-center justify-center rounded-full bg-brand-50 text-2xl">
              {{ activity.emoji }}
            </div>
            <h3 class="text-2xl font-semibold text-gray-900">
              {{ activity.title }}
            </h3>
          </div>
          <p class="mt-4 text-sm text-gray-600">
            {{ activity.description }}
          </p>
          <NuxtLink
            :to="activity.href"
            class="mt-6 inline-flex items-center gap-2 text-sm font-semibold text-secondaryBrand-600 hover:text-secondaryBrand-500"
          >
            {{ activity.cta }}
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8 5l8 7-8 7" />
            </svg>
          </NuxtLink>
        </article>
      </div>
    </div>
  </section>

  <!-- Section Stages -->
  <section id="stages" class="bg-brand-950 py-24 sm:py-32 text-white">
    <div class="mx-auto max-w-7xl px-6 lg:px-8">
      <h2 class="text-4xl font-semibold tracking-tight text-pretty sm:text-5xl">
        Les prochains stages d'escalade
      </h2>
      <p class="mt-2 text-lg/8 text-brand-100/80">
        Embarque pour notre prochaine aventure.
      </p>

      <div v-if="aventuresPending" class="mt-12 text-sm text-brand-100/70">
        Chargement des stages...
      </div>
      <div v-else-if="!upcomingStages.length" class="mt-12 text-sm text-brand-100/70">
        Encore aucune date publiÃ©e. Reviens trÃ¨s vite !
      </div>
      <div v-else class="mt-12 grid gap-6 md:grid-cols-3">
        <NuxtLink
          v-for="stage in upcomingStages"
          :key="stage.id"
          :to="`/aventures-escalade/${stage.slug}`"
          class="group flex flex-col overflow-hidden rounded-3xl border border-white/10 bg-white/5 shadow-2xl shadow-black/40 ring-1 ring-white/10 transition hover:-translate-y-1"
        >
          <div class="relative h-52">
            <img
              :src="stage.coverImageUrl || imageForDiscipline(stage.discipline)"
              :alt="stage.titre"
              class="size-full object-cover transition duration-500 group-hover:scale-105"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent" />
            <div class="absolute inset-4 flex flex-col justify-between">
              <span
                class="inline-flex items-center rounded-full bg-white/10 px-3 py-1 text-[11px] font-semibold uppercase tracking-[0.3em] text-white backdrop-blur"
              >
                {{ formatDisciplineLabel(stage.discipline) }}
              </span>
              <span class="text-sm font-semibold text-white">
                {{ stage.nextSession ? formatSessionRange(stage.nextSession) : 'Date Ã  confirmer' }}
              </span>
            </div>
          </div>
          <div class="flex flex-1 flex-col p-5">
            <p class="text-sm font-semibold text-secondaryBrand-300">
              {{ stage.jours }} jour{{ stage.jours > 1 ? 's' : '' }}
            </p>
            <h3 class="mt-2 text-xl font-semibold text-white">
              {{ stage.titre }}
            </h3>
            <p class="mt-1 line-clamp-2 text-sm text-brand-100/80">
              {{ stage.sousTitre }}
            </p>
            <p class="mt-3 flex items-center gap-2 text-sm text-brand-100/70">
              <svg class="h-4 w-4 text-secondaryBrand-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 21c-4-4-6-7-6-10a6 6 0 1 1 12 0c0 3-2 6-6 10Z" />
                <circle cx="12" cy="11" r="2.3" />
              </svg>
              {{ stage.lieuLabel }}
            </p>
            <div class="mt-4 flex items-center gap-3 text-sm text-brand-100/80">
              <img
                :src="stage.guideImageUrl || imageForDiscipline(stage.discipline)"
                :alt="stage.guideName || 'Moniteur'"
                class="h-10 w-10 rounded-full border border-white/20 bg-brand-900 object-cover"
              />
              <div>
                <p class="text-xs uppercase tracking-[0.3em] text-brand-200/70">
                  Moniteur
                </p>
                <p class="font-semibold text-white">
                  {{ stage.guideName || 'Moniteur local' }}
                </p>
              </div>
            </div>
            <div class="mt-6 flex items-center justify-between text-sm text-white">
              <span class="font-semibold">
                {{ stage.prixParPersonne }} â‚¬ <span class="text-brand-200 text-xs">/ pers</span>
              </span>
              <span class="inline-flex items-center gap-2 text-secondaryBrand-300">
                Voir lâ€™aventure
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8 5l8 7-8 7" />
                </svg>
              </span>
            </div>
          </div>
        </NuxtLink>
      </div>
    </div>
  </section>

  <!-- Footer rÃ©utilisable -->
  <AppFooter />
</template>

<script setup lang="ts">
import { computed, onBeforeUnmount, onMounted, ref } from 'vue'

const { data: aventuresData, pending: aventuresPending } = await useFetch('/api/aventures')

  const upcomingStages = computed(() => {
    const list = (aventuresData.value?.aventures ?? []).map((stage: any) => {
      const nextDate = stage.nextSession?.dateDebut ? new Date(stage.nextSession.dateDebut) : null
      return { ...stage, nextSessionDate: nextDate }
    })

    const withNext = list
      .filter((stage: any) => stage.nextSessionDate)
      .sort((a: any, b: any) => (a.nextSessionDate as any) - (b.nextSessionDate as any))

    if (withNext.length >= 3) {
      return withNext.slice(0, 3)
    }

    return list.slice(0, 3)
  })

  const faqs = [
    {
      question: 'La diffÃ©rence entre l\'escalade en couenne et l\'escalade en grande voie ?',
      answer: "L'escalade en couenne, appelÃ©e escalade sportive, consiste Ã  grimper une voie d'une seule longueur, sur une falaise ou sur une paroi artificielle (salle d'escalade) complÃ¨tement Ã©quipÃ©e avec des ancrages permanents, permettant au grimpeur de s'assurer Ã  l'aide de dÃ©gaines. Il existe des voies de tous niveaux, facile Ã  extrÃªmement difficile. IdÃ©ale pour l'initiation et pour progresser.\n\nL'escalade en grande voie consiste Ã  grimper une voie de plusieurs longueurs, sur des grandes falaises plus ou moins Ã©quipÃ©es avec des points bÃ©tons. L'objectif est d'escalader en cordÃ©e jusqu'au sommet de la falaise. Cette pratique nÃ©cessite de connaÃ®tre des manipulations et techniques particuliÃ¨res. Il existe des grandes voies de tous niveaux, pouvant durer de la demi-journÃ©e Ã  plusieurs jours.",
    },
    {
      question: "La diffÃ©rence entre l'escalade en tÃªte et l'escalade en moulinette ?",
      answer: "L'escalade en tÃªte consiste Ã  grimper en contribuant Ã  son propre assurage. En plus d'Ãªtre assurer par son assureur, le grimpeur en tÃªte doit progressivement installer les dÃ©gaines et passer sa corde dans les dÃ©gaines afin d'assurer sa sÃ©curitÃ© en cas de chute. Il n'y a pas de corde prÃ©-installÃ©e. Il est donc important pour le grimpeur en tÃªte de choisir une voie adaptÃ©e Ã  son niveau et ne pas surestimer son niveau, car il devra arriver jusqu'au relais.\n\nL'escalade en moulinette consiste Ã  grimper sur une corde dÃ©jÃ  installÃ©e sur la falaise. Il est donc possible, en cas de difficultÃ©, de redescendre Ã  tout moment.",
    },
  ]

  const rotatingBenefitWords = ['progression', 'immersion', 'dÃ©connexion', 'reconnexion'];
  const activeBenefitWordIndex = ref(0);
  const activeBenefitWord = computed(() => rotatingBenefitWords[activeBenefitWordIndex.value]);

  let benefitInterval: ReturnType<typeof setInterval> | null = null;

  onMounted(() => {
    benefitInterval = setInterval(() => {
      activeBenefitWordIndex.value = (activeBenefitWordIndex.value + 1) % rotatingBenefitWords.length;
    }, 2500);
  });

  onBeforeUnmount(() => {
    if (benefitInterval) clearInterval(benefitInterval);
  });

  const benefits = [
    {
      kicker: 'Escalade outdoor',
      title: 'Reconnecte avec le milieu naturel',
      description:
        'DÃ©couvre les milliers de spots de nos territoires en pratiquant dehors. Au soleil ou Ã  lâ€™ombre selon la saison, apprends Ã  jouer avec la mÃ©tÃ©o pour vivre des moments inoubliables en falaise.',
      emoji: 'ğŸŒ',
    },
    {
      kicker: 'Progression',
      title: 'Ã‰mulation garantie & moniteurs diplÃ´mÃ©s',
      description:
        'Notre objectif est de te faire prendre goÃ»t Ã  lâ€™escalade en milieu naturel, mais surtout de te faire progresser et tâ€™accompagner vers lâ€™autonomie.',
      emoji: 'ğŸ“ˆ',
    },
    {
      kicker: 'Club',
      title: 'Rencontre tes futurs partenaires',
      description:
        'Pas toujours simple de trouver les bonnes personnes avec qui grimper. Pendant nos stages, tu rencontres des grimpeurs et grimpeuses motivÃ©Â·es pour partager la corde.',
      emoji: 'ğŸ¤',
    },
    {
      kicker: 'AuthenticitÃ©',
      title: 'Moniteurs locaux passionnÃ©s',
      description:
        'Nos Moniteurs aiment leur territoire et vous font dÃ©couvrir les joyaux de leurs rÃ©gions : plus belles voies, meilleures adresses pour manger ou dormirâ€¦ tu es entre de bonnes mains.',
      emoji: 'ğŸ§­',
    },
  ];

  const activities = [
    {
      title: 'Falaise',
      description:
        'Escalade dâ€™une longueur aussi appelÃ©e â€œcouenneâ€ ou â€œescalade de difficultÃ©â€ qui vise Ã  gravir une paroi de 10m Ã  50m en sâ€™assurant Ã  lâ€™aide de dÃ©gaines sur des points fixes.',
      cta: 'Les stages falaise',
      href: '/escalade-sportive-couenne-falaise',
      emoji: 'ğŸ§—â€â™€ï¸',
    },
    {
      title: 'Grande voie',
      description:
        'EnchaÃ®ne plusieurs longueurs (jusquâ€™Ã  plusieurs centaines de mÃ¨tres) encordÃ©Â·e Ã  2 ou 3 personnes avec matÃ©riel et techniques spÃ©cifiques : relais, rappels, assurageâ€¦',
      cta: 'Les stages grande voie',
      href: '/escalade-grande-voie',
      emoji: 'ğŸ—»',
    },
    {
      title: 'Trad',
      description:
        'En escalade traditionnelle, tu places toi-mÃªme tes protections dans les faiblesses du rocher Ã  lâ€™aide de coinceurs, friends, pitons ou sangles.',
      cta: 'Les stages trad',
      href: '/escalade-trad',
      emoji: 'ğŸ› ï¸',
    },
    {
      title: 'Bloc',
      description:
        'Sans corde et sur des blocs de moins de 5m, avec parade et crashpads pour amortir les chutes. Parfait pour travailler la gestuelle et la puissance.',
      cta: 'Les stages bloc',
      href: '/escalade-bloc',
      emoji: 'ğŸ§±',
    },
  ];

  const disciplineLabels: Record<string, string> = {
    GRANDE_VOIE: 'Grande voie',
    FALAISE: 'Falaise',
    BLOC: 'Bloc',
    TRAD: 'Trad',
  }

  const formatDisciplineLabel = (value?: string | null) => {
    if (!value) return 'Aventure'
    return disciplineLabels[value] ?? value
  }

  const disciplineImages: Record<string, string> = {
    GRANDE_VOIE: '/images/escalade-grande-voie-calanques.jpg',
    FALAISE: '/images/falaise-escalade-beaufortain.jpg',
    BLOC: '/images/bloc-Pays-Basque-Mondarrain.jpg',
    TRAD: '/images/falaise-Calanques2.jpg',
  }

  const imageForDiscipline = (value?: string | null) => {
    if (!value) return '/images/escalade-grande-voie-calanques.jpg'
    return disciplineImages[value] || '/images/escalade-grande-voie-calanques.jpg'
  }

  const formatSessionRange = (session: any) => {
    if (!session?.dateDebut || !session?.dateFin) return ''
    const formatter = new Intl.DateTimeFormat('fr-FR', { day: 'numeric', month: 'long' })
    const start = formatter.format(new Date(session.dateDebut))
    const end = formatter.format(new Date(session.dateFin))
    return start === end ? start : `${start} â†’ ${end}`
  }

</script>

<style>
  html {
    scroll-behavior: smooth;
  }
</style>
